<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: 'en' }}">
  <head>
    {% include head.html %}
    <script src="https://unpkg.com/color.js@1.2.0/dist/color.js"></script>
  </head>
  <body>
    {% include header.html %}

    <main>
      {% include globe.html %}

      <nav>
        <button>North America</button>
        <button>South America</button>
        <button>Europe</button>
        <button>Asia</button>
      </nav>

      <ol class="event-list">
        {% assign sorted_posts = site.posts | sort: 'datestart' %} {% for post
        in sorted_posts %}
        <li class="event-list-item" id="event-list-item-{{ forloop.index }}">
          <img
            class="event-list-item-image"
            src="{{ post.image }}"
            alt="{{ post.title | smartify }} image"
            data-index="{{ forloop.index }}"
            draggable="false"
            loading="lazy"
          />

          <div class="event-list-item-metadata">
            <a class="event-list-item-metadata-title" href="{{ post.url }}"
              >{{ post.title | smartify }}</a
            >
            <div class="event-list-item-metadata-date">
              <time datetime="{{ post.datestart | date: '%Y-%m-%d' }}">
                {{ post.datestart | date: "%b %d" }}
              </time>

              {% if post.dateend %} &nbsp;â€“&nbsp;
              <time datetime="{{ post.dateend | date: '%Y-%m-%d' }}">
                {{ post.dateend | date: "%b %d" }}
              </time>
              {% endif %}
            </div>
            <div class="event-list-item-metadata-location">
              <!-- prettier-ignore -->
              {% assign location_parts = post.location | split: ',' %}
              {% assign country_part = location_parts | last | strip %}
              {% assign country = country_part %} 

              {% case country %}
                {% when 'USA' %}
                  {% assign flag = 'ðŸ‡ºðŸ‡¸' %}
                {% when 'Canada' %}
                  {% assign flag = 'ðŸ‡¨ðŸ‡¦' %}
                {% when 'UK' %}
                  {% assign flag = 'ðŸ‡¬ðŸ‡§' %}
                {% when 'Nederland' %}
                  {% assign flag = 'ðŸ‡³ðŸ‡±' %}
                {% when 'Belgium' %}
                  {% assign flag = 'ðŸ‡§ðŸ‡ª' %}
                {%- else -%}
                  {% assign flag = '' %}
              {% endcase %}

              {{ flag }}
            </div>
          </div>
        </li>
        {% endfor %}
      </ol>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Select all images
        const images = document.querySelectorAll(".event-list-item-image");

        images.forEach((img) => {
          const index = img.dataset.index; // Get the index from the data attribute
          colorjs.average(img.src).then((color) => {
            const rgbColor = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
            const listItem = document.getElementById(
              `event-list-item-${index}`
            );
            listItem.style.backgroundColor = rgbColor; // Apply the color to the <li>
          });
        });
      });
    </script>
  </body>
</html>
